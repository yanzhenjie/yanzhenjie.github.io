async function initPostHelper(){const e="encrypt";KEEP.utils.postHelper={postPageContainerDom:document.querySelector(".post-page-container"),toggleShowTocBtn:document.querySelector(".toggle-show-toc"),toggleShowTocTabletBtn:document.querySelector(".toggle-show-toc-tablet"),mainContentDom:document.querySelector(".main-content"),postToolsDom:document.querySelector(".post-tools"),isShowToc:!1,initToggleToc(){this.toggleShowTocBtn&&this.toggleShowTocBtn.addEventListener("click",(()=>{this.postPageContainerDom.classList.contains(e)||(this.isShowToc=!this.isShowToc,KEEP.themeInfo.styleStatus.isShowToc=this.isShowToc,KEEP.setStyleStatus(),this.handleToggleToc(this.isShowToc))})),this.toggleShowTocTabletBtn&&this.toggleShowTocTabletBtn.addEventListener("click",(()=>{if(this.postPageContainerDom.classList.contains(e))return;const t=document.querySelector(".tablet-post-toc-mask"),o=t.querySelector(".tablet-post-toc");document.body.style.overflow="hidden",t.style.background="rgba(0, 0, 0, 0.25)",t.style.visibility="visible",o.style.transform="translateX(0)",t.addEventListener("click",(()=>{document.body.style.overflow="",t.style.background="rgba(0, 0, 0, 0)",t.style.visibility="hidden",o.style.transform="translateX(-100%)"}))}))},handleToggleToc(e){e?(this.postPageContainerDom.classList.add("show-toc"),document.body.classList.add("has-toc")):(this.postPageContainerDom.classList.remove("show-toc"),document.body.classList.remove("has-toc")),setTimeout((()=>{this.setPostToolsLayout()}),100)},hasToc(e){this.toggleShowTocBtn&&(this.toggleShowTocBtn.style.display="flex",this.isShowToc=e,this.handleToggleToc(e))},setPostToolsLayout(e){const t=e||this.mainContentDom.getBoundingClientRect().width.toFixed(0);let o=5;window.innerWidth<=800&&(o=3);const s="left"===KEEP.theme_config.toc?.layout?"right":"left";this.postToolsDom.style.opacity="1",this.postToolsDom.style[s]=`calc((100vw - ${t}px) / 2 - ${o}rem)`},initSetPostToolsLeft(){setTimeout((()=>{this.setPostToolsLayout()}),150),window.addEventListener("resize",(()=>{this.setPostToolsLayout()}))},goToComments(){const e=document.querySelector("#comments-anchor");[document.querySelector(".post-tools .go-to-comments"),document.querySelector(".exposed-tools-list .go-to-comments-tablet")].forEach((t=>{KEEP.utils.title2Top4HTag(t,e,300)}))},watchPostCommentsCount(){const e=this.postToolsDom.querySelector(".post-comments-count");if(!e)return;const t=new MutationObserver((function(o){o.forEach((o=>{if("childList"===o.type){const s=Number(o.target.innerHTML);s>0&&(e.style.display="flex",s>99&&(e.innerHTML="99+",t.disconnect()))}}))}));t.observe(e,{attributes:!0,childList:!0})},setArticleAgingDays(){const e=document.querySelector(".post-content .post-aging-tips");if(e){const t=e.querySelector(".days"),o=Date.now(),s=864e5,n=(e.dataset?.agingDays||30)*s,c=o-new Date(e.dataset.updateDate).getTime(),i=(c/s).toFixed(0);c>=n&&(t.innerHTML=i,e.style.display="block")}},resetPostUpdateDate(){const e=document.querySelector(".post-meta-info-container .post-update-date .datetime"),t=new Date(e.dataset.updated).getTime(),o=KEEP.theme_config.post?.datetime_format||KEEP.themeInfo.defaultDatetimeFormat;e.innerHTML=KEEP.utils.formatDatetime(o,t)},enableFullScreen(){const e=document.querySelector(".post-tools-container .full-screen");if(e){const t=e.querySelector("i"),o=()=>document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement,s=()=>{o()?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen()},n=()=>{o()?(t.classList.remove("fa-expand"),t.classList.add("fa-compress")):(t.classList.remove("fa-compress"),t.classList.add("fa-expand"))};e.addEventListener("click",(function(){s()})),document.addEventListener("fullscreenchange",n),document.addEventListener("mozfullscreenchange",n),document.addEventListener("webkitfullscreenchange",n)}},hexToBuffer:e=>new Uint8Array(e.match(/[\da-f]{2}/gi).map((e=>parseInt(e,16)))).buffer,async decrypt(e,t){const o={name:"AES-CBC",iv:this.hexToBuffer(e.iv)},s=await crypto.subtle.importKey("raw",this.hexToBuffer(t),o,!1,["decrypt"]),n=await crypto.subtle.decrypt(o,s,this.hexToBuffer(e.encryptedData));return(new TextDecoder).decode(n)},encryptTocHandle(e){setTimeout((()=>{const t=document.querySelector(".pc-post-toc");t&&(this.handleToggleToc(e),e?t?.removeAttribute("style"):t.style.display="none")}))},async postEncryptHandle(){const t=document.querySelector(".post-content"),o=t.querySelector(".post-encrypt-box"),s=document.querySelector(".post-tools-list .post-lock"),n=`${KEEP.themeInfo.encryptKey}#${location.pathname}`,c="decrypt";if(o){this.encryptTocHandle(!1);const{secret:i,ep:l,content:a,iv:r}=o.dataset;o.removeAttribute("data-secret"),o.removeAttribute("data-iv"),o.removeAttribute("data-ep"),o.removeAttribute("data-content");const d=o.querySelector(".password-input"),u=async(n=!1)=>{const u=d.value,m=await this.decrypt({iv:r,encryptedData:l},i),p=async()=>{const n=await this.decrypt({iv:r,encryptedData:a},i);o.style.display="none",t.removeChild(o),this.postPageContainerDom.classList.remove(e),this.encryptTocHandle(!0),t.querySelector(".post").innerHTML=n,setTimeout((()=>{KEEP.initLazyLoad(),KEEP.initCodeBlock(),KEEP.initTOC(),KEEP.utils.zoomInImage(),KEEP.utils.insertTooltipContent(),KEEP.utils.tabsActiveHandle(),KEEP.utils.wrapTableWithBox(),KEEP.utils.aAnchorJump()})),s.classList.add(c),s.classList.add("tooltip"),sessionStorage.setItem(`${KEEP.themeInfo.encryptKey}#${location.pathname}`,"1")};n||u===m?await p():d.classList.add("error")};sessionStorage.getItem(n)&&await u(!0),d.addEventListener("keydown",(async e=>{""===d.value&&d.classList.remove("error"),13===e.keyCode&&(await u(),e.preventDefault())})),d.addEventListener("keyup",(async e=>{""===d.value&&d.classList.remove("error")})),s.addEventListener("click",(()=>{s.classList.contains(c)&&(s.classList.remove(c),sessionStorage.removeItem(n),location.reload())}))}}},KEEP.utils.postHelper.initSetPostToolsLeft(),KEEP.utils.postHelper.setArticleAgingDays(),KEEP.utils.postHelper.resetPostUpdateDate(),KEEP.utils.postHelper.enableFullScreen(),KEEP.utils.postHelper.postPageContainerDom.classList.contains(e)&&await KEEP.utils.postHelper.postEncryptHandle(),!0===KEEP.theme_config.toc?.enable&&KEEP.utils.postHelper.initToggleToc(),!0===KEEP.theme_config.comment?.enable&&(KEEP.utils.postHelper.goToComments(),KEEP.utils.postHelper.watchPostCommentsCount())}!0===KEEP.theme_config.pjax?.enable&&KEEP.utils?initPostHelper():window.addEventListener("DOMContentLoaded",initPostHelper);